<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Streams API Example</title>
</head>
<body>
<h1>Read Out Streams</h1>
<img src="tortoise.png" width="150" height="84">
<img src="tortoise.png" width="150" height="84" id="target">
<script src="pako.min.js"></script>
<script src="png-lib.js"></script>
<script type="application/javascript">

// Fetch the original image
fetch('tortoise.png')
// Retrieve its body as ReadableStream
.then((response) => response.body)
// Create a gray-scaled PNG stream out of the original
.then((body) => new Response(new ReadableStream(new PngGrayScaleStreamSource(body))))
.then((newResponse) => newResponse.blob())
.then((blob) => URL.createObjectURL(blob))
.then((url) => {
  const image = document.getElementById('target');
  image.src = url;
})
.catch((err) => console.error(err));

</script>
</body>
</html>
